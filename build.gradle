/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn more about Gradle by exploring our samples at https://docs.gradle.org/8.0/samples
 */

//подключение Java плагина
plugins {
    id 'java'
    //теперь можно выполнить команду gradle tasks и посмотреть все доступные таски
    //далее можно попробовать выполнить gradle build и посмотреть ациклическое дерево все такок
}

repositories {
    mavenCentral()
}

configurations {
    Configuration configurationImpl = getByName("implementation")

    customConfiguration {
        description = "custom configuration"
    }
    configurationImpl.extendsFrom(customConfiguration)
}

dependencies {
    // 1й способ добавить зависимости
    /*add("implementation",[group:  "org.junit.jupiter", name: "junit-jupiter", version: "5.9.2"])
    add("implementation",[group:  "org.springframework", name: "spring-webmvc", version: "6.0.6"])*/

    //2й способ добавить зависимости
    /*    add("implementation","org.junit.jupiter:junit-jupiter:5.9.2")
    add("implementation", 'org.springframework:spring-webmvc:6.0.6')*/

    //3й способ добавить зависимости
    customConfiguration 'org.springframework:spring-webmvc:6.0.6'
    testImplementation 'org.junit.jupiter:junit-jupiter:5.9.2'
}

sourceSets {
    main {
        java {
            srcDir "$buildDir/generated-sources/mapstruct"
        }
    }

}

//через блок ext можно добавлять настройки (properties) gradle
ext {
    javaVersion = 17
}

println ""

//способы получения gradle properties
println javaVersion
println ext.javaVersion
println project.ext.javaVersion
println project.javaVersion

println ""

println "Configuration phase"
println "Gradle hash code: ${gradle.hashCode()}"
println "Project hash code: ${rootProject.hashCode()}"

//task("hello")

//1
/*
def helloTask = tasks.findByName("hello")
helloTask.group = "custom group"
helloTask.description = "This is the Hello task"
*/

//2
/*
hello.group = "custom group"
hello.description = "This is the Hello task"
*/

//3
/*
hello {
    println "Configuration phase. Hello task"
    group = "custom group"
    description = "This is the Hello task"
}
*/

//4
/*
task hello {
    println "Configuration phase. Hello task"
    group = "custom group"
    description = "This is the Hello task"
}
*/

//5
task hello(group: "custom group", description: "This is the Hello task") {
    doLast {
        println "Second action"
    }
    doFirst {
        println "First action"
    }
    doLast {
        println "Third action"
    }
    println "Configuration phase. Hello task"
    println "Group: $group, description: $description, number of actions: $actions.size()"
    println "Task path: $path"
}

task firstTask {
    doLast {
        println "First task"
    }
}

task thirdTask {
    doLast {
        println "Third task"
    }
}

task secondTask {
    dependsOn(firstTask)
    finalizedBy(thirdTask)
    doLast {
        println "Second task"
    }
}

task forthTask {
    dependsOn(secondTask)
    doLast {
        println "Forth task"
    }
}

gradle.taskGraph.whenReady { TaskExecutionGraph graph ->
    println "----- Graph: "
    graph.allTasks.each {
        println "${it.name}"
    }
}

task seventhTask {
    doLast {
        println "Seventh task"
    }
}
task sixthTask {
    mustRunAfter(seventhTask)
    doLast {
        println "Sixth task"
    }
}
task fivethTask {
    mustRunAfter(sixthTask)
    doLast {
        println "Fiveth task"
    }
}
task eighthTask {
    group = "custom group"
    dependsOn([fivethTask, sixthTask, seventhTask])
    doLast {
        println "Eighth task"
    }
}

//noinspection GrDeprecatedAPIUsage
gradle.taskGraph.beforeTask { Task task ->
    if (task.group == "custom group") {
        println "Before task callback"
    }
}

//noinspection GrDeprecatedAPIUsage
gradle.taskGraph.afterTask { Task task ->
    if (task.group == "custom group") {
        println "After task callback"
    }
}

//Используем таску из скрипта
apply from: 'myscript.gradle'

//Плагин

//Используем таску из плагина

class MyPlugin implements Plugin<Project> {

    @Override
    void apply(Project target) {
        def map = [description: "plugin tasks", group: "plugin tasks"]

        target.task(map, "plugintask") {
            doLast {
                println "run plugin task"
            }
        }
    }
}

apply plugin: MyPlugin


